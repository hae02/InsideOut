<?xml version="1.0" encoding="UTF-8"?>
 <!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="boardns">

	 <!--공지 게시판 작성 -->
	<insert id="board_insert" parameterType="board">
		<selectKey keyProperty="post_no" order="BEFORE" resultType="int">
			select max(post_no)+1 from post			
		</selectKey>
		insert into post(board_no, writer_id, post_title, post_content, htmlPost_content,
		serial_number , post_readcount, post_dt)
		values (#{board_no}, '학사과', #{post_title}, #{post_content}, #{htmlPost_content}, CONCAT(#{board_no},#{post_no}), 0, sysdate())
	</insert>
	
	<!-- 첨부파일 -->
	<insert id="file_insert" parameterType="board">
		<selectKey keyProperty="serial_number" order="BEFORE" resultType="String">
			select serial_number from post order by post_no desc limit 0,1			
		</selectKey>
		insert into file( real_file_nm, save_file_nm,
		 file_path, file_size, serial_number)
		values ( #{real_file_nm}, #{save_file_nm}, #{file_path},#{file_size}, #{serial_number} )
	</insert>
	
	
	<!-- 공지 첨부파일 저장 되는지 확인해야됨-->
	<!-- <insert id="file_insert" parameterType="board">
		insert into file( real_file_nm, save_file_nm,
		 file_path, file_size, serial_number)
		values ( #{file_name}, #{newfile_name}, #{file_path},#{file_size}, 0 )

	</insert> -->
	
	<!-- file serial_number 값 입력
	<update id="serial_update" parameterType="board">
	UPDATE post
	SET serial_number = CONCAT(board_no, post_no) where postno;
	</update>
	-->
	
  	<!--공지게시판 총게시물 수 -->
  	<!-- 400 -> parameterType=400 추후 변경 -->
	<select id="notice_count" resultType="int">
		select count(*) from post where board_no = 400 
	</select>
	
	<!--공지게시판 목록 -->
	<select id="notice_list" parameterType="int" resultType="board">
	<![CDATA[
      select * from (select @rownum := @rownum + 1 as rnum, s1.* from post s1,
      (select @rownum := 0 ) s2 order by post_no desc) s2
      where rnum >= ((#{page}-1) * 10 + 1) and rnum <= (#{page} * 10) and board_no = 400
      ]]>
      <!-- 
	   select * from post where board_no = 400 order by post_no desc
	   order by board_re_ref desc, board_re_seq asc limit #{start}, 10 
 -->
	</select>
	
	<!-- 게시판 상세보기 -->
	<select id="board_cont" parameterType="int" resultType="board">
		select * from post p JOIN file f On p.serial_number = f.serial_number where post_no=#{post_no} 
	</select>
	
	
	<!-- 게시판 조회수 증가  -->
	<update id ="board_hit" parameterType="int">
		update post set post_readcount= post_readcount+1
		where post_no=#{post_no}
	</update>
	
	
	<!-- 게시판 삭제 -->
	<delete id="board_del" parameterType="int">
		delete from post where post_no=#{post_no}
	</delete>
	
	<!--취업게시판 총게시물 수
	<select id="notice_count" resultType="int">
    select count(*) from post
    where board_no = 400
	</select>
	
	자주하는 질문게시판 총게시물 수
	<select id="notice_count" resultType="int">
    select count(*) from post
    where board_no = 400
	</select>
	
	
	 -->
	
</mapper>	