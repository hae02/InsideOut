<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.InsideOut.dao.AdminDao">

	<select id="getAllMembers" resultType="member">
		<![CDATA[
		select * from (select @rownum := @rownum + 1 as rnum, m1.* from member m1,
		(select @rownum := 0 ) m2 order by mem_no*1 desc) m2
		where rnum >= ((#{pageNum}-1) * 10 + 1)  and rnum <= (#{pageNum} * 10)
		]]>
	</select>
	
	<select id="getSearchMembers" resultType="member">
		select * from member where username = #{keyword}
	</select>

	<!-- 만들다 말음 -->
	<select id="updateMembers" parameterType="int"
		resultType="member">
		select * from member where mem_no = #{mem_no}
	</select>

	<delete id="deleteMembers" parameterType="int">
		delete from member where mem_no = #{mem_no}
	</delete>

	<!-- <select id="getMemberList" resultType="member"> <![CDATA[ select * 
		from (select @rownum := @rownum + 1 as rnum, s1.* from member s1, (select 
		@rownum := 0 ) s2 order by mem_no desc) s2 where rnum >= ((#{page}-1) * 10 
		+ 1) and rnum <= (#{page} * 10) and mem_no = #{mem_no} ]]> </select> <select 
		id="getMemberCount" parameterType="String" resultType="int"> select count(*) 
		from member where mem_no = #{mem_no} </select> -->

	<!-- 게시글 목록 조회 -->
	<select id="list" parameterType="member" resultType="member">
		<!-- select free_subject, free_nick, free_regdate, free_readcount from 
			freeboard where free_del = 0 order by free_no desc -->
		<!-- 게시판 테이블에서 모든 데이터를 조회, rownum 값을 같이 조죄하기 위해 서브쿼리 사용 -->
		<!-- rownum에 해당하는 게시글만 추출하기 위해 다시한번 select문 사용 -->
		<!-- rownum을 rn이라는 별칭으로 부여 -->
		select * from (select a.*,rowNum rn from (
		select * from member
		<where>	<!-- 검색어(keyword)와 검색 기준(search)을 이용하여 검색 조건에 맞게 동적으로 SQL 쿼리를 생성 -->
			<if test="keyword != null and search=='all'">
				username like '%'||#{keyword}||'%'
			</if>
			<if test="keyword != null and search!='all'">
				${search} like '%'||#{keyword}||'%'
			</if>
			<!-- <if test="keyword != null and search=='subcon'"> free_subject like 
				'%'||#{keyword}||'%' or free_content like '%'||#{keyword}||'%' </if> -->
		</where>
		<!-- 답글이 있는 게시글들이 최신순으로 정렬되면서 그룹화 -->
		order by mem_no desc) a )
		<!-- where절에서 검색어가 포함된 게시글을 검색하도록 처리 -->
		where rn between #{startRow} and #{endRow}
	</select>

	<!-- 데이터 총 개수 -->
	<select id="getTotal" resultType="int">
		select count(*) from member
		<!-- <where>검색어 포함한 데이터 개수 검색
			<if test="keyword != null and search=='all'">
				${search} like '%' || #{keyword} || '%'
			</if>
			<if test="keyword != null and search !='all'">
				username like '%'||#{keyword}||'%'
			</if>
		</where> -->
	</select>
	
	<select id="getSearchTotal" parameterType="String" resultType="int">
		select count(*) from member where username = #{keyword}
	</select>





</mapper>